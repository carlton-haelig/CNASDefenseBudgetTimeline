<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Federal Budget Events Timeline</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            background-color: #37373d;
        }

        body {
            color: #fff;
            font-family: 'Arial', 'Helvetica', sans-serif;
            padding: 2rem;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2.5rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 0.5rem solid #fff;
        }

        .subtitle {
            font-size: 1.1rem;
            margin-bottom: 3rem;
            color: #ccc;
        }

        .controls {
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .controls button {
            padding: 0.7rem 1.5rem;
            background-color: #58c1c6;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .controls button:hover {
            background-color: #4aa8ad;
        }

        #loading {
            text-align: center;
            font-size: 1.2rem;
            padding: 3rem;
            color: #ccc;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            margin-bottom: 3rem;
            padding: 1.5rem;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.7rem;
        }

        .legend-color {
            width: 2.5rem;
            height: 0.6rem;
            border-radius: 2px;
        }

        .legend-text {
            font-size: 0.95rem;
        }

        .color-pbd { background-color: #58c1c6; }
        .color-cr { background-color: #d47371; }
        .color-app { background-color: #ddb375; }
        .color-gs { background-color: #7a2b2a; }
        .color-eofy { 
            background: transparent;
            border-bottom: 2px dashed #fff;
            height: 0;
        }

        .timeline-container {
            position: relative;
            overflow-x: auto;
            padding: 2rem 0;
        }

        .timeline {
            position: relative;
            display: flex;
            gap: 0;
            min-width: 100%;
        }

        .year-column {
            flex: 0 0 120px;
            position: relative;
            border-right: 1px solid #555;
            padding: 0 0.5rem;
        }

        .year-column:last-child {
            border-right: none;
        }

        .year-label {
            position: sticky;
            top: 0;
            background-color: #37373d;
            padding: 0.5rem;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            border-bottom: 2px solid #fff;
            margin-bottom: 1rem;
            z-index: 10;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .year-label:hover {
            background-color: #4a4a50;
        }

        .events-container {
            position: relative;
            min-height: 400px;
            padding-top: 1rem;
        }

        .event-bar {
            width: 0.8rem;
            margin: 0 auto 0.3rem;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scaleY(0);
            }
            to {
                opacity: 1;
                transform: scaleY(1);
            }
        }

        .event-bar:hover {
            transform: scaleX(1.5);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .event-marker {
            position: relative;
            width: 2.5rem;
            height: 0.6rem;
            margin: 0 auto 0.5rem;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .event-marker:hover {
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .tooltip {
            position: absolute;
            background-color: #fff;
            color: #000;
            padding: 1rem;
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            min-width: 250px;
            max-width: 350px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip-date {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #37373d;
        }

        .tooltip-event {
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .tooltip-link {
            display: inline-block;
            margin-top: 0.5rem;
            color: #58c1c6;
            text-decoration: none;
            font-weight: bold;
        }

        .tooltip-link:hover {
            text-decoration: underline;
        }

        .month-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            pointer-events: none;
        }

        .month-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 1px;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .eofy-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: transparent;
            border-bottom: 2px dashed #fff;
        }

        .error {
            background-color: #d47371;
            color: #fff;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .year-column {
                flex: 0 0 80px;
            }

            .legend {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Federal Budget Events Timeline</h1>
        <p class="subtitle">Interactive visualization of budget-related events by fiscal year</p>

        <div class="controls">
            <button onclick="loadData()">ðŸ”„ Refresh Data</button>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color color-pbd"></div>
                <div class="legend-text">President's Budget Delivered</div>
            </div>
            <div class="legend-item">
                <div class="legend-color color-cr"></div>
                <div class="legend-text">Continuing Resolution</div>
            </div>
            <div class="legend-item">
                <div class="legend-color color-app"></div>
                <div class="legend-text">Appropriation</div>
            </div>
            <div class="legend-item">
                <div class="legend-color color-gs"></div>
                <div class="legend-text">Government Shutdown</div>
            </div>
            <div class="legend-item">
                <div class="legend-color color-eofy"></div>
                <div class="legend-text">End of Fiscal Year (Sept 30)</div>
            </div>
        </div>

        <div id="loading">Loading data...</div>
        <div id="error" class="error" style="display: none;"></div>
        <div id="visualization" class="timeline-container" style="display: none;"></div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        // Configuration - REPLACE WITH YOUR CSV FILE PATH
        const CSV_FILE = 'data.csv'; // Change this to your CSV filename

        // Event type colors
        const eventColors = {
            'Presidents Budget Delivered to Congress': '#58c1c6',
            'Continuing Resolution': '#d47371',
            'Appropriation': '#ddb375',
            'Government Shutdown': '#7a2b2a'
        };

        // Parse CSV data
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const result = [];
            
            // Skip header row (line 0)
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                // Simple CSV parsing (handles quoted fields)
                const values = [];
                let current = '';
                let inQuotes = false;
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current.trim());
                
                if (values.length >= 4) {
                    result.push(values);
                }
            }
            
            return result;
        }

        // Parse date from MM/DD/YYYY format
        function parseDate(dateStr) {
            const parts = dateStr.split('/');
            if (parts.length !== 3) return null;
            return new Date(parts[2], parts[0] - 1, parts[1]);
        }

        // Get fiscal year from calendar date
        function getFiscalYear(date) {
            const year = date.getFullYear();
            const month = date.getMonth();
            // Federal fiscal year starts Oct 1
            return month >= 9 ? year + 1 : year;
        }

        // Get day of fiscal year (0 = Oct 1, 364 = Sept 30)
        function getDayOfFiscalYear(date) {
            const fy = getFiscalYear(date);
            const fyStart = new Date(fy - 1, 9, 1); // Oct 1 of previous calendar year
            const diff = date - fyStart;
            return Math.floor(diff / (1000 * 60 * 60 * 24));
        }

        // Load data from CSV file
        async function loadData() {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const visualization = document.getElementById('visualization');

            loading.style.display = 'block';
            error.style.display = 'none';
            visualization.style.display = 'none';

            try {
                const response = await fetch(CSV_FILE);
                
                if (!response.ok) {
                    throw new Error(`Failed to fetch CSV file: ${response.statusText}. Make sure '${CSV_FILE}' exists in your repository.`);
                }

                const csvText = await response.text();
                const rows = parseCSV(csvText);

                if (rows.length === 0) {
                    throw new Error('No data found in CSV file');
                }

                // Parse data
                // CSV columns: Timestamp, Fiscal Year, Date, Event Type, URL
                const events = [];
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    if (row.length >= 4) {
                        const date = parseDate(row[2]); // Date column (index 2)
                        if (date) {
                            events.push({
                                fiscalYear: parseInt(row[1]), // Fiscal Year column (index 1)
                                date: date,
                                eventType: row[3], // Event Type column (index 3)
                                url: row[4] || '', // URL column (index 4)
                                dayOfFY: getDayOfFiscalYear(date)
                            });
                        }
                    }
                }

                if (events.length === 0) {
                    throw new Error('No valid events found in CSV. Check that your data format matches: Timestamp, Fiscal Year, Date (MM/DD/YYYY), Event Type, URL');
                }

                renderVisualization(events);

            } catch (err) {
                console.error('Error loading data:', err);
                error.textContent = `Error: ${err.message}`;
                error.style.display = 'block';
                loading.style.display = 'none';
            }
        }

        // Render the visualization
        function renderVisualization(events) {
            const loading = document.getElementById('loading');
            const visualization = document.getElementById('visualization');

            // Group events by fiscal year
            const eventsByYear = {};
            events.forEach(event => {
                if (!eventsByYear[event.fiscalYear]) {
                    eventsByYear[event.fiscalYear] = [];
                }
                eventsByYear[event.fiscalYear].push(event);
            });

            // Sort years
            const years = Object.keys(eventsByYear).sort();

            // Create timeline
            let html = '<div class="timeline">';

            years.forEach(year => {
                const yearEvents = eventsByYear[year].sort((a, b) => a.dayOfFY - b.dayOfFY);
                
                html += `
                    <div class="year-column">
                        <div class="year-label" title="Fiscal Year ${year}">FY ${year}</div>
                        <div class="events-container">
                            <div class="month-grid">
                                ${generateMonthGrid()}
                            </div>
                `;

                // Add events
                yearEvents.forEach((event, idx) => {
                    const color = eventColors[event.eventType] || '#999';
                    const topPosition = (event.dayOfFY / 365) * 100;
                    
                    html += `
                        <div class="event-marker" 
                             style="background-color: ${color}; position: absolute; top: ${topPosition}%; left: 50%; transform: translateX(-50%);"
                             data-event='${JSON.stringify(event).replace(/'/g, "&apos;")}'
                             onmouseover="showTooltip(event, this)"
                             onmouseout="hideTooltip()">
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            });

            html += '</div>';

            visualization.innerHTML = html;
            visualization.style.display = 'block';
            loading.style.display = 'none';
        }

        // Generate month grid lines
        function generateMonthGrid() {
            let html = '';
            // Add line for end of fiscal year (Sept 30 = day 365)
            html += '<div class="eofy-line" style="top: 100%;"></div>';
            
            // Add lines for each month
            const monthDays = [31, 30, 31, 30, 31, 31, 30, 31, 30, 31, 28]; // Oct-Aug
            let cumDays = 0;
            monthDays.forEach(days => {
                cumDays += days;
                const topPosition = (cumDays / 365) * 100;
                html += `<div class="month-line" style="top: ${topPosition}%;"></div>`;
            });
            
            return html;
        }

        // Show tooltip
        function showTooltip(e, element) {
            const tooltip = document.getElementById('tooltip');
            const event = JSON.parse(element.getAttribute('data-event'));
            
            const dateStr = `${event.date.getMonth() + 1}/${event.date.getDate()}/${event.date.getFullYear()}`;
            
            let html = `
                <div class="tooltip-date">${dateStr}</div>
                <div class="tooltip-event">${event.eventType}</div>
            `;
            
            if (event.url) {
                html += `<a href="${event.url}" target="_blank" class="tooltip-link">View Source â†’</a>`;
            }
            
            tooltip.innerHTML = html;
            
            // Position tooltip
            const rect = element.getBoundingClientRect();
            tooltip.style.left = rect.right + 20 + 'px';
            tooltip.style.top = rect.top + window.scrollY - 20 + 'px';
            
            tooltip.classList.add('show');
        }

        // Hide tooltip
        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.classList.remove('show');
        }

        // Load data on page load
        loadData();
    </script>
</body>
</html>
